### 问题描述

考虑如下的组合优化问题。设有一座城市，共有若干居民楼，总数记为 $n \in \mathbb{Z}_+$，楼栋索引集合为 $\mathcal{I} = \{1,2,\dots,n\}$。对于每一栋楼 $i \in \mathcal{I}$，已知其潜在需要使用电动车充电桩的总人数为 $D_i \ge 0$，且每覆盖其中一名用户即可带来收益 $p_i \ge 0$，其中 $p_i$ 可以理解为统一的单位收益，也可以因楼而异。规划部门预先给出了 $m$ 个可选的充电桩区域，区域索引集合为 $\mathcal{J} = \{1,2,\dots,m\}$。每个区域 $j \in \mathcal{J}$ 所能服务的楼栋集合是给定的，用覆盖关系矩阵 $a_{ij}$ 表示，其中
$$
a_{ij} =
\begin{cases}
1, & \text{若区域 } j \text{ 可以覆盖楼栋 } i,\\
0, & \text{否则}。
\end{cases}
$$

不同区域之间的覆盖范围可以重叠，即可能存在某些楼栋同时属于多个区域的覆盖范围。若选择建设区域 $j$，则需要支付一笔固定建设成本 $c_j \ge 0$，该成本可包含土建、配电、设备安装及相关手续费用等。在区域 $j$ 内可以设置若干个充电桩，设其数量为 $x_j$，但受物理条件、规划或容量约束，每个区域可设置的充电桩数量存在上限 $U_j \in \mathbb{Z}_+$，超过这一上限在实际规划中不可行。为简化模型，假定每个充电桩可以服务一个“单位用户”（或认为每个桩的服务能力已折算为统一的用户单位），从而区域 $j$ 实际可服务的用户总数上界为 $x_j$。我们的目标是在预算和容量约束条件下，决定哪些区域需要建设以及在每个已建设区域中设置多少个充电桩，并在覆盖关系限制下将各楼栋的用户分配到相应区域，使“覆盖用户带来的总收益减去建设成本”的净收益最大化。

为刻画这一决策过程，引入如下决策变量。首先，对每个区域 $j \in \mathcal{J}$ 定义 0–1 决策变量

$$
z_j =
\begin{cases}
1, & \text{若在区域 } j \text{ 建设充电桩区域},\\
0, & \text{否则}。
\end{cases}
$$

变量 $z_j$ 表示是否选择在区域 $j$ 进行建设。其次，用变量 $x_j$ 表示在区域 $j$ 内设置的充电桩数量，为了反映桩数的离散性，可以规定 $x_j \in \mathbb{Z}_+$（若允许将服务能力视为连续容量近似，也可以放宽为 $x_j \ge 0$）。再次，用变量 $y_{ij}$ 表示楼栋 $i$ 中被分配到区域 $j$ 进行充电的用户人数，对所有楼栋–区域对 $(i,j)$ 规定 $y_{ij} \ge 0$。由于只有在区域 $j$ 能够覆盖楼栋 $i$ 且该区域被建设的情况下，才允许将楼栋 $i$ 的用户分配到区域 $j$，因此可以通过如下约束刻画这一逻辑关系：

$$
y_{ij} \le D_i\, a_{ij}\, z_j,\quad \forall i \in \mathcal{I},\ \forall j \in \mathcal{J}.
$$

当 $a_{ij} = 0$ 或 $z_j = 0$ 时，上述约束强制 $y_{ij} = 0$，从而禁止在未覆盖或未建设的区域中为该楼栋分配用户。每栋楼的用户总数不能被超额分配，即对每个 $i \in \mathcal{I}$ 有

$$
\sum_{j \in \mathcal{J}} y_{ij} \le D_i,
$$

这表示来自楼栋 $i$ 的所有分配人数总和不得超过其潜在需求 $D_i$。另一方面，区域 $j$ 的服务能力受到其内部充电桩数量的限制。由于假定每个桩可服务一个单位用户，因此区域 $j$ 能服务的用户总数上界为 $x_j$，从而对每个 $j \in \mathcal{J}$ 有容量约束

$$
\sum_{i \in \mathcal{I}} y_{ij} \le x_j.
$$

充电桩数量又受到区域上限的控制，并且只有在区域被建设时才允许设置充电桩，为此对每个 $j \in \mathcal{J}$ 引入联动约束

$$
0 \le x_j \le U_j\, z_j.
$$

当 $z_j = 0$ 时，该约束强制 $x_j = 0$，表示未建设的区域不能配置充电桩；当 $z_j = 1$ 时则允许 $x_j$ 在区间 $[0, U_j]$ 内取值。上述变量需满足的类型条件可以总结为

$$
z_j \in \{0,1\},\quad x_j \ge 0,\quad y_{ij} \ge 0,\quad \forall i \in \mathcal{I},\ \forall j \in \mathcal{J}.
$$

在给定参数和决策变量下，所有被成功覆盖的用户带来的总收益可以表示为

$$
\sum_{i \in \mathcal{I}} \sum_{j \in \mathcal{J}} p_i\, y_{ij},
$$

而为建设各个区域支付的总固定成本为

$$
\sum_{j \in \mathcal{J}} c_j\, z_j.
$$

因此，我们希望最大化的净收益（即总收益减去总成本）为

$$
\sum_{i \in \mathcal{I}} \sum_{j \in \mathcal{J}} p_i\, y_{ij} \;-\; \sum_{j \in \mathcal{J}} c_j\, z_j.
$$

将上述目标函数与约束条件综合起来，可以得到该充电桩选址与配置问题的形式化数学规划模型：

$$
\begin{aligned}
\max_{z,x,y}\quad & \sum_{i \in \mathcal{I}} \sum_{j \in \mathcal{J}} p_i\, y_{ij} \;-\; \sum_{j \in \mathcal{J}} c_j\, z_j,\\
\text{s.t.}\quad 
& y_{ij} \le D_i\, a_{ij}\, z_j,\quad && \forall i \in \mathcal{I},\ \forall j \in \mathcal{J},\\[4pt]
& \sum_{j \in \mathcal{J}} y_{ij} \le D_i,\quad && \forall i \in \mathcal{I},\\[4pt]
& \sum_{i \in \mathcal{I}} y_{ij} \le x_j,\quad && \forall j \in \mathcal{J},\\[4pt]
& 0 \le x_j \le U_j\, z_j,\quad && \forall j \in \mathcal{J},\\[4pt]
& z_j \in \{0,1\},\ x_j \ge 0,\ y_{ij} \ge 0,\quad && \forall i \in \mathcal{I},\ \forall j \in \mathcal{J}.
\end{aligned}
$$

该模型刻画了在存在覆盖重叠、建设成本以及容量上限等现实约束条件下，如何选择建设哪些充电区域并配置相应数量的充电桩，以及如何将不同楼栋的用户分配到各个区域，从而最大化总体经济收益的组合优化问题，本质上属于一个混合整数线性规划（Mixed-Integer Linear Programming, MILP）模型。

---



### 规约证明

在前面给出的数学模型基础上，下面从计算复杂度的角度，对该充电桩选址与配置问题进行形式化分析，给出其判定版本属于 NP，并通过从集合覆盖（Set Cover）问题的多项式时间规约证明该问题是 NP-hard，从而其判定版本为 NP-complete，优化版本为 NP-hard。

我们先将原始的**优化问题**改写为一个**判定问题**。给定参数
- 楼栋集合 $\mathcal{I} = \{1,\dots,n\}$，区域集合 $\mathcal{J} = \{1,\dots,m\}$；
- 潜在需求 $D_i \ge 0$，单位收益 $p_i \ge 0$；
- 区域固定成本 $c_j \ge 0$，最大桩数上限 $U_j \in \mathbb{Z}_+$；
- 覆盖关系矩阵 $a_{ij} \in \{0,1\}$；
- 以及目标阈值 $K \in \mathbb{R}$，

考虑如下判定问题：

> 是否存在一组决策变量 $(z,x,y)$ 满足所有约束  
> $$
> \begin{aligned}
> & y_{ij} \le D_i a_{ij} z_j,\quad && \forall i\in\mathcal{I},\ \forall j\in\mathcal{J},\\
> & \sum_{j\in\mathcal{J}} y_{ij} \le D_i,\quad && \forall i\in\mathcal{I},\\
> & \sum_{i\in\mathcal{I}} y_{ij} \le x_j,\quad && \forall j\in\mathcal{J},\\
> & 0 \le x_j \le U_j z_j,\quad && \forall j\in\mathcal{J},\\
> & z_j\in\{0,1\},\ x_j\ge 0,\ y_{ij}\ge 0,\quad && \forall i\in\mathcal{I},\ \forall j\in\mathcal{J},
> \end{aligned}
> $$
> 且目标函数满足
> $$
> \sum_{i\in\mathcal{I}}\sum_{j\in\mathcal{J}} p_i\, y_{ij} - \sum_{j\in\mathcal{J}} c_j\, z_j \;\ge K\ ?
> $$

记这个判定问题为 **充电桩选址判定问题**。

---

**一、该判定问题属于 NP**

给定一个候选解 $(z,x,y)$，我们可以在多项式时间内验证它是否为一个“证据”（certificate）：

1. **检查线性约束**：对每个 $(i,j)$ 检查  
   $y_{ij} \le D_i a_{ij} z_j$，  
   对每个 $i$ 检查 $\sum_{j} y_{ij} \le D_i$，  
   对每个 $j$ 检查 $\sum_{i} y_{ij} \le x_j$ 和 $0 \le x_j \le U_j z_j$。  
   这些都是有限个线性不等式，个数为 $\mathcal{O}(nm + n + m)$，逐一计算和比较的时间是多项式的。

2. **检查变量类型**：对每个 $j$ 检查 $z_j\in\{0,1\}$，对每个 $j$ 检查 $x_j\ge 0$，对每个 $(i,j)$ 检查 $y_{ij}\ge 0$，显然也是线性规模的检查。

3. **计算目标函数并比较阈值**：在 $\mathcal{O}(nm + m)$ 时间内计算
   $$
   \sum_{i\in\mathcal{I}}\sum_{j\in\mathcal{J}} p_i\, y_{ij} - \sum_{j\in\mathcal{J}} c_j\, z_j
   $$
   并与给定阈值 $K$ 做一次比较即可。

假设所有输入参数（包括 $D_i,p_i,c_j,U_j,a_{ij},K$ 等）都以二进制编码给出，则上述检验步骤的时间复杂度为输入规模的多项式。因此，该判定问题属于类 $\mathrm{NP}$：一旦给出一个候选解，就可以在多项式时间内验证其可行性以及目标值是否达到阈值 $K$。

---

**二、从 Set Cover 向本问题的多项式时间规约**

为了证明该问题是 NP-hard，我们从经典的集合覆盖问题（Set Cover）构造一个多项式时间规约。集合覆盖判定问题定义如下：

- 给定一个有限集合（宇宙）  
  $$
  U = \{e_1,e_2,\dots,e_n\},
  $$
- 一族子集  
  $$
  \mathcal{S} = \{S_1,S_2,\dots,S_m\},\quad S_j \subseteq U,
  $$
- 以及一个正整数 $k$，

问：是否存在一个索引集合 $J^\star \subseteq \{1,\dots,m\}$，满足 $|J^\star| \le k$ 且
$$
\bigcup_{j\in J^\star} S_j = U\ ?
$$

该问题是著名的 NP-complete 问题。我们将证明：对任意一个 Set Cover 实例 $(U,\mathcal{S},k)$，都可以在多项式时间内构造一个充电桩选址判定实例，使得前者存在规模不超过 $k$ 的覆盖当且仅当后者存在一个目标值不小于某一阈值 $K$ 的可行解。

---

**构造步骤**

给定 Set Cover 实例 $(U,\mathcal{S},k)$，其中
$$
U = \{e_1,\dots,e_n\},\quad
\mathcal{S} = \{S_1,\dots,S_m\},
$$
我们按如下方式构造一个充电桩选址实例。

1. **楼栋与元素对应**

   将每个元素 $e_i\in U$ 对应为一栋楼 $i$。于是楼栋集合为
   $$
   \mathcal{I} = \{1,\dots,n\},\quad n = |U|.
   $$
   对每栋楼 $i$ 设置潜在需求
   $$
   D_i = 1,\quad \forall i\in\mathcal{I},
   $$
   即每个元素只需要“被服务”一次。为简化，将每个被覆盖用户的收益设置为统一常数：
   $$
   p_i = M,\quad \forall i\in\mathcal{I},
   $$
   其中常数 $M$ 取为
   $$
   M = m + 1.
   $$

2. **区域与子集对应**

   将每个子集 $S_j$ 对应为一个候选区域 $j$。于是区域集合为
   $$
   \mathcal{J} = \{1,\dots,m\},\quad m = |\mathcal{S}|.
   $$
   定义覆盖关系矩阵 $a_{ij}$ 为
   $$
   a_{ij} =
   \begin{cases}
   1, & \text{若 } e_i \in S_j,\\
   0, & \text{否则},
   \end{cases}
   \qquad \forall i\in\mathcal{I},\ \forall j\in\mathcal{J},
   $$
   即区域 $j$ 正好覆盖集合 $S_j$ 对应的那些楼栋。

3. **容量与建设成本**

   为避免容量约束人为限制，令每个区域的最大桩数上限足够大，例如
   $$
   U_j = n,\quad \forall j\in\mathcal{J},
   $$
   并允许 $x_j$ 足以服务所有其覆盖的楼栋（因为每栋最多 1 个用户）。区域建设成本设为常数
   $$
   c_j = 1,\quad \forall j\in\mathcal{J},
   $$
   即每选一个区域的成本为 1。在容量足够大的情况下，只要 $z_j = 1$，就完全可以为该区域能覆盖到的楼栋提供服务。

4. **阈值设定**

   在该充电问题上，我们关注如下目标函数：
   $$
   \text{Profit}(z,x,y) = 
   \sum_{i\in\mathcal{I}}\sum_{j\in\mathcal{J}} p_i\, y_{ij} - \sum_{j\in\mathcal{J}} c_j\, z_j.
   $$
   在上述构造下，由于 $D_i = 1$，每个楼栋 $i$ 要么完全被某个区域服务（贡献 $M$ 的收益），要么完全未被服务（贡献 $0$）。记被成功覆盖的楼栋集合为
   $$
   C(J) = \{i\in\mathcal{I} : \text{存在 } j\in\mathcal{J} \text{ 使 } y_{ij} = 1\},
   $$
   记被选择的区域集合为
   $$
   J = \{j\in\mathcal{J}: z_j = 1\}.
   $$
   此时可以将目标函数重写为
   $$
   \text{Profit}(J) = M\cdot |C(J)| - |J|.
   $$

   我们在规约中选择阈值
   $$
   K = M n - k.
   $$

   稍后将证明：原 Set Cover 实例存在大小不超过 $k$ 的覆盖，当且仅当该充电实例存在一组可行解 $(z,x,y)$ 使得 $\text{Profit}(z,x,y) \ge K$。

5. **构造规模与时间**

   从 $(U,\mathcal{S},k)$ 构造上述参数 $D_i,p_i,c_j,U_j,a_{ij},K$ 的过程，只需要遍历所有元素和子集，计算 $a_{ij}$，其时间复杂度为多项式（约为 $\mathcal{O}(nm)$），因此该规约是多项式时间的。

---

**三、规约正确性的证明**

我们证明如下的等价性命题：

> 原 Set Cover 实例存在一个大小不超过 $k$ 的集合覆盖  
> 当且仅当  
> 构造的充电选址实例存在一个可行解使  
> $$
> \text{Profit}(z,x,y) \ge K = M n - k.
> $$

**（1）如果存在集合覆盖，则存在利润至少为 $K$ 的解**

假设在 Set Cover 实例中，存在一个索引集合 $J^\star \subseteq \{1,\dots,m\}$，满足
$$
|J^\star| \le k,\quad \bigcup_{j\in J^\star} S_j = U.
$$

在充电实例中构造如下解：

- 对 $j\in J^\star$，令 $z_j = 1$；对 $j\notin J^\star$，令 $z_j = 0$；
- 对每个选择的区域 $j\in J^\star$，取足够多的桩数（例如 $x_j = n$），显然满足 $x_j \le U_j z_j$；
- 由于 $J^\star$ 是集合覆盖，对每个楼栋 $i$，至少存在某个 $j\in J^\star$ 使 $a_{ij} = 1$。从中任取一个区域 $j$，令 $y_{ij} = 1$，其余 $y_{ij'} = 0$。这样对所有楼栋 $i$ 都有 $\sum_{j} y_{ij} = 1 \le D_i$，并且对每个区域 $j$ 有
  $$
  \sum_{i} y_{ij} \le n = x_j,
  $$
  所有约束均被满足。

此时所有楼栋都被覆盖，即 $C(J^\star) = \mathcal{I}$，从而 $|C(J^\star)| = n$。目标函数为
$$
\text{Profit}(J^\star) = M n - |J^\star|
\ge M n - k = K.
$$
因此，若 Set Cover 实例有大小不超过 $k$ 的覆盖，则充电实例中存在一个可行解使目标值至少为 $K$。

---

**（2）如果存在利润至少为 $K$ 的解，则存在大小不超过 $k$ 的集合覆盖**

反方向，假设在充电实例中存在一个可行解 $(z,x,y)$，对应的区域集合
$$
J = \{j\in\mathcal{J} : z_j = 1\},
$$
满足
$$
\text{Profit}(J) = M |C(J)| - |J| \ge K = M n - k.
$$

首先证明该解必须覆盖所有楼栋，即 $|C(J)| = n$。

若存在某个楼栋 $i$ 未被服务，则 $i\notin C(J)$，因此 $|C(J)| \le n-1$。注意 $|J|\ge 0$，故有
$$
\text{Profit}(J) = M|C(J)| - |J|
\le M (n-1) - 0 = M(n-1).
$$
而
$$
K = M n - k \ge M n - m.
$$
代入 $M = m + 1$，得到
$$
M n - m = (m+1)n - m = (m+1)(n-1) + (m+1 - m)
= M (n-1) + 1.
$$
于是
$$
K \ge M(n-1) + 1 > M(n-1).
$$
这与 $\text{Profit}(J) \le M(n-1)$ 和 $\text{Profit}(J) \ge K$ 矛盾。因此，任何满足 $\text{Profit}(J)\ge K$ 的可行解必须满足 $|C(J)| = n$，即所有楼栋都被覆盖。

在 $|C(J)| = n$ 的情况下，目标函数化简为
$$
\text{Profit}(J) = M n - |J|.
$$
条件 $\text{Profit}(J)\ge K = M n - k$ 等价于
$$
M n - |J| \ge M n - k
\quad\Longleftrightarrow\quad
|J| \le k.
$$

由于 $|C(J)| = n$，说明对每个楼栋 $i$ 都存在 $j\in J$ 使 $a_{ij}=1$，也即
$$
\{e_i : i\in\mathcal{I}\} \subseteq \bigcup_{j\in J} S_j.
$$
由构造中楼栋与元素一一对应可知
$$
\bigcup_{j\in J} S_j = U,
$$
且 $|J|\le k$。这说明集合 $J$ 在原 Set Cover 实例中给出了一个大小不超过 $k$ 的集合覆盖。

综上，如果在充电实例中存在利润不小于 $K$ 的可行解，则相应地在 Set Cover 实例中存在一个规模不超过 $k$ 的集合覆盖。

---

**（3）规约总结**

上述构造在输入规模的多项式时间内完成，并且满足
- Set Cover 实例为 “Yes” 当且仅当
- 对应的充电选址判定实例为 “Yes”（存在解使目标值 $\ge K$）。

因此，我们得到从 Set Cover 判定问题到充电桩选址判定问题的多项式时间规约。由于 Set Cover 判定问题是 NP-complete，且我们的充电判定问题已证明属于 NP，由此可知：

- 充电桩选址判定问题是 NP-complete；
- 相应的优化问题（最大化利润）是 NP-hard。

这意味着在一般情况下，除非 $\mathrm{P} = \mathrm{NP}$，不存在多项式时间算法可以求得该优化问题的全局最优解；该问题在复杂度意义上属于典型的组合优化难题。